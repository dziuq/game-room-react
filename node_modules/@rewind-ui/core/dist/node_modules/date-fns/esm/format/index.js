import isValid from"../isValid/index.js";import subMilliseconds from"../subMilliseconds/index.js";import toDate from"../toDate/index.js";import formatters from"../_lib/format/formatters/index.js";import longFormatters from"../_lib/format/longFormatters/index.js";import getTimezoneOffsetInMilliseconds from"../_lib/getTimezoneOffsetInMilliseconds/index.js";import{isProtectedWeekYearToken,throwProtectedError,isProtectedDayOfYearToken}from"../_lib/protectedTokens/index.js";import toInteger from"../_lib/toInteger/index.js";import requiredArgs from"../_lib/requiredArgs/index.js";import{getDefaultOptions}from"../_lib/defaultOptions/index.js";import defaultLocale from"../locale/en-US/index.js";var formattingTokensRegExp=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,longFormattingTokensRegExp=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,escapedStringRegExp=/^'([^]*?)'?$/,doubleQuoteRegExp=/''/g,unescapedLatinCharacterRegExp=/[a-zA-Z]/;function format(e,o,t){var r,n,i,a,l,s,d,u,c,f,m,g,p,v,k,w,x,E;requiredArgs(2,arguments);var h=String(o),b=getDefaultOptions(),D=null!==(r=null!==(n=null==t?void 0:t.locale)&&void 0!==n?n:b.locale)&&void 0!==r?r:defaultLocale,R=toInteger(null!==(i=null!==(a=null!==(l=null!==(s=null==t?void 0:t.firstWeekContainsDate)&&void 0!==s?s:null==t||null===(d=t.locale)||void 0===d||null===(u=d.options)||void 0===u?void 0:u.firstWeekContainsDate)&&void 0!==l?l:b.firstWeekContainsDate)&&void 0!==a?a:null===(c=b.locale)||void 0===c||null===(f=c.options)||void 0===f?void 0:f.firstWeekContainsDate)&&void 0!==i?i:1);if(!(R>=1&&R<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var O=toInteger(null!==(m=null!==(g=null!==(p=null!==(v=null==t?void 0:t.weekStartsOn)&&void 0!==v?v:null==t||null===(k=t.locale)||void 0===k||null===(w=k.options)||void 0===w?void 0:w.weekStartsOn)&&void 0!==p?p:b.weekStartsOn)&&void 0!==g?g:null===(x=b.locale)||void 0===x||null===(E=x.options)||void 0===E?void 0:E.weekStartsOn)&&void 0!==m?m:0);if(!(O>=0&&O<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!D.localize)throw new RangeError("locale must contain localize property");if(!D.formatLong)throw new RangeError("locale must contain formatLong property");var S=toDate(e);if(!isValid(S))throw new RangeError("Invalid time value");var T=getTimezoneOffsetInMilliseconds(S),j=subMilliseconds(S,T),P={firstWeekContainsDate:R,weekStartsOn:O,locale:D,_originalDate:S};return h.match(longFormattingTokensRegExp).map((function(e){var o=e[0];return"p"===o||"P"===o?(0,longFormatters[o])(e,D.formatLong):e})).join("").match(formattingTokensRegExp).map((function(r){if("''"===r)return"'";var n=r[0];if("'"===n)return cleanEscapedString(r);var i=formatters[n];if(i)return null!=t&&t.useAdditionalWeekYearTokens||!isProtectedWeekYearToken(r)||throwProtectedError(r,o,String(e)),null!=t&&t.useAdditionalDayOfYearTokens||!isProtectedDayOfYearToken(r)||throwProtectedError(r,o,String(e)),i(j,r,D.localize,P);if(n.match(unescapedLatinCharacterRegExp))throw new RangeError("Format string contains an unescaped latin alphabet character `"+n+"`");return r})).join("")}function cleanEscapedString(e){var o=e.match(escapedStringRegExp);return o?o[1].replace(doubleQuoteRegExp,"'"):e}export{format as default};
