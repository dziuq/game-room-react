import{useContext,useRef,useInsertionEffect,useEffect}from"react";import{PresenceContext}from"../../context/PresenceContext.js";import{MotionContext}from"../../context/MotionContext/index.js";import{useIsomorphicLayoutEffect}from"../../utils/use-isomorphic-effect.js";import{LazyContext}from"../../context/LazyContext.js";import{MotionConfigContext}from"../../context/MotionConfigContext.js";function useVisualElement(t,e,n,o){const{visualElement:i}=useContext(MotionContext),r=useContext(LazyContext),s=useContext(PresenceContext),a=useContext(MotionConfigContext).reducedMotion,u=useRef();o=o||r.renderer,!u.current&&o&&(u.current=o(t,{visualState:e,parent:i,props:n,presenceContext:s,blockInitialAnimation:!!s&&!1===s.initial,reducedMotionConfig:a}));const c=u.current;useInsertionEffect((()=>{c&&c.update(n,s)}));const f=useRef(Boolean(window.HandoffAppearAnimations));return useIsomorphicLayoutEffect((()=>{c&&(c.render(),f.current&&c.animationState&&c.animationState.animateChanges())})),useEffect((()=>{c&&(c.updateFeatures(),!f.current&&c.animationState&&c.animationState.animateChanges(),window.HandoffAppearAnimations=void 0,f.current=!1)})),c}export{useVisualElement};
