"use strict";var index$1=require("./index.cjs"),easing=require("./easing.cjs"),getFinalKeyframe=require("./utils/get-final-keyframe.cjs"),index=require("../js/index.cjs"),timeConversion=require("../../../utils/time-conversion.cjs"),memo=require("../../../utils/memo.cjs"),noop=require("../../../utils/noop.cjs"),frame=require("../../../frameloop/frame.cjs");const supportsWaapi=memo.memo((()=>Object.hasOwnProperty.call(Element.prototype,"animate"))),acceleratedValues=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),sampleDelta=10,maxDuration=2e4,requiresPregeneratedKeyframes=(e,a)=>"spring"===a.type||"backgroundColor"===e||!easing.isWaapiSupportedEasing(a.ease);function createAcceleratedAnimation(e,a,{onUpdate:t,onComplete:r,...i}){if(!(supportsWaapi()&&acceleratedValues.has(a)&&!i.repeatDelay&&"mirror"!==i.repeatType&&0!==i.damping&&"inertia"!==i.type))return!1;let n,s,o=!1;const l=()=>{s=new Promise((e=>{n=e}))};l();let{keyframes:c,duration:m=300,ease:u,times:p}=i;if(requiresPregeneratedKeyframes(a,i)){const e=index.animateValue({...i,repeat:0,delay:0});let a={done:!1,value:c[0]};const t=[];let r=0;for(;!a.done&&r<2e4;)a=e.sample(r),t.push(a.value),r+=10;p=void 0,c=t,m=r-10,u="linear"}const d=index$1.animateStyle(e.owner.current,a,c,{...i,duration:m,ease:u,times:p}),f=()=>d.cancel(),y=()=>{frame.frame.update(f),n(),l()};d.onfinish=()=>{e.set(getFinalKeyframe.getFinalKeyframe(c,i)),r&&r(),y()};return{then:(e,a)=>s.then(e,a),attachTimeline:e=>(d.timeline=e,d.onfinish=null,noop.noop),get time(){return timeConversion.millisecondsToSeconds(d.currentTime||0)},set time(e){d.currentTime=timeConversion.secondsToMilliseconds(e)},get speed(){return d.playbackRate},set speed(e){d.playbackRate=e},get duration(){return timeConversion.millisecondsToSeconds(m)},play:()=>{o||(d.play(),frame.cancelFrame(f))},pause:()=>d.pause(),stop:()=>{if(o=!0,"idle"===d.playState)return;const{currentTime:a}=d;if(a){const t=index.animateValue({...i,autoplay:!1});e.setWithVelocity(t.sample(a-10).value,t.sample(a).value,10)}y()},complete:()=>d.finish(),cancel:y}}exports.createAcceleratedAnimation=createAcceleratedAnimation;
