'use client';
"use strict";var tslib=require("tslib"),jsxRuntime=require("react/jsx-runtime"),combobox_reducer=require("./combobox.reducer.cjs"),Combobox_types=require("./Combobox.types.cjs"),ComboboxGroup=require("./ComboboxGroup/ComboboxGroup.cjs"),ComboboxOption=require("./ComboboxOption/ComboboxOption.cjs"),useCombobox_hook=require("./use-combobox.hook.cjs"),FormControl_context=require("../FormControl/FormControl.context.cjs"),InputGroup_context=require("../InputGroup/InputGroup.context.cjs"),Spinner=require("../Spinner/Spinner.cjs"),react=require("@floating-ui/react"),useKeypress=require("../../hooks/use-keypress.cjs"),useVerticalArrows_hook=require("../../hooks/use-vertical-arrows.hook.cjs"),XMark=require("../../icons/XMark.cjs"),theme_context=require("../../theme/theme.context.cjs"),usePropId=require("../../utils/usePropId.cjs"),React=require("react"),Combobox_context=require("./Combobox.context.cjs"),CaretUpDown=require("../../icons/CaretUpDown.cjs");const defaultProps={clearable:!0,closeOnEscape:!0,closeOnSelect:!0,color:"dark",disabled:!1,loading:!1,maxHeight:250,minWidth:250,mode:"spacey",multiple:!1,offset:5,optionColor:"gray",radius:"lg",searchable:!0,shadow:"none",size:"md",tone:"light",validation:"none",withRing:!0},_Combobox=React.forwardRef(((e,o)=>{var t,s,a,n;const i=theme_context.useComponentTheme("Combobox"),r=Object.assign(Object.assign(Object.assign(Object.assign({},defaultProps),FormControl_context.useFormControlContext()),InputGroup_context.useInputGroupContext()),e),{children:l,className:c,clearable:u,closeOnEscape:b,closeOnSelect:d,color:m,controlId:p,initialValue:x,leftIcon:h,loading:g,maxHeight:j,minWidth:C,mode:y,multiple:R,offset:f,onChange:v,onSearch:O,optionColor:_,placeholder:E,radius:w,searchable:I,shadow:N,size:q,tone:k,validation:A,value:z,withRing:S}=r,P=tslib.__rest(r,["children","className","clearable","closeOnEscape","closeOnSelect","color","controlId","initialValue","leftIcon","loading","maxHeight","minWidth","mode","multiple","offset","onChange","onSearch","optionColor","placeholder","radius","searchable","shadow","size","tone","validation","value","withRing"]),G=usePropId.usePropId(e.id),F=React.useId(),W=usePropId.usePropId(p),K=e.disabled||g,L=!!h,M=!0,[V,B]=React.useReducer(combobox_reducer.comboboxReducer,{multiple:R||!1,initialValue:x,onChange:v,options:[],selectedOptions:[],search:"",searching:!1}),[$,D]=React.useState([]),[H,U]=React.useState(""),[X,T]=React.useState(i.base({className:c,color:m,disabled:K,hasLeftIcon:L,hasRightIcon:M,radius:w,shadow:N,size:q,tone:k,validation:A,withRing:S})),[J,Q]=React.useState(null),Y=React.useRef(null),Z=React.useRef(null),ee=React.useRef(null),oe={externalSearch:!!O,mode:y,multiple:R,optionColor:_,radius:w,size:q,state:V,dispatch:B},{x:te,y:se,reference:ae,floating:ne,strategy:ie,getFloatingProps:re,open:le,setOpen:ce}=useCombobox_hook.useCombobox({offset:f}),ue=react.useMergeRefs([ae,Y,o||null]),be=react.useMergeRefs([Z,ne]),de=i.wrapper({disabled:K}),me=i.noResults({size:q}),pe=h?i.icon({tone:k,size:q,className:h.props.className}):null,xe=i.leftIconWrapper({size:q}),he=i.icon({tone:k,size:q}),ge=i.rightIconWrapper({color:m,size:q});React.useEffect((()=>{Y.current&&Q(Y.current.getBoundingClientRect().width)}),[]),React.useEffect((()=>{z?R&&Array.isArray(z)&&z.length>0?B({type:Combobox_types.ComboboxActionEnum.init_multi_select,payload:{values:z}}):R||"string"!=typeof z||B({type:Combobox_types.ComboboxActionEnum.single_select,payload:{value:z}}):B({type:Combobox_types.ComboboxActionEnum.reset,payload:null})}),[z,R]),React.useEffect((()=>{var e;le&&(null===(e=ee.current)||void 0===e||e.focus()),ye()}),[le]),useKeypress.useKeypress("Escape",!0,(()=>{B({type:Combobox_types.ComboboxActionEnum.search_reset,payload:null}),le&&b&&ce(!1)})),useKeypress.useKeypress("Backspace",le,(()=>{V.search||B({type:Combobox_types.ComboboxActionEnum.remove_last,payload:null})})),useKeypress.useKeypress("Enter",!0,(()=>{var e;if(!V.searching)return;const o=null===(e=Z.current)||void 0===e?void 0:e.querySelector('button[aria-hidden="false"]:not([aria-disabled="true"])');o&&o.click()})),React.useLayoutEffect((()=>{setTimeout((()=>{Z.current&&D(Array.from(Z.current.querySelectorAll('button[aria-hidden="false"][aria-disabled="false"]')))}),1),ye()}),[V.search]),React.useEffect((()=>{le&&d&&ce(!1)}),[V.selectedOptions]),useVerticalArrows_hook.useVerticalArrows($,le);const je=jsxRuntime.jsx("div",Object.assign({className:X},{children:jsxRuntime.jsxs("div",Object.assign({className:i.tagWrapper({size:q})},{children:[R&&(null===(t=V.selectedOptions)||void 0===t?void 0:t.map(((e,o)=>jsxRuntime.jsxs("div",Object.assign({className:i.tag({disabled:K,radius:w,size:q,tone:k})},{children:[jsxRuntime.jsx("button",Object.assign({type:"button",disabled:K,"aria-label":`Remove ${e.label}`,className:i.tagButton({color:m,disabled:K}),onClick:o=>{B({type:Combobox_types.ComboboxActionEnum.multi_select,payload:{value:e.value,toggle:!0}}),o.stopPropagation()}},{children:jsxRuntime.jsx("span",Object.assign({className:i.tagButtonIcon()},{children:"âœ•"}))})),jsxRuntime.jsx("span",{children:e.label})]}),`label-${o}`)))),(!R||le||0===V.selectedOptions.length)&&jsxRuntime.jsx("input",{id:W,ref:ee,disabled:K,className:i.input({size:q}),role:"combobox","aria-controls":F,"aria-autocomplete":I?"both":"list","aria-haspopup":"listbox","aria-expanded":le,value:V.searching?V.search:(R?"":null===(s=V.selectedOptions[0])||void 0===s?void 0:s.label)||"",placeholder:V.selectedOptions.length?"":E,readOnly:!I,autoComplete:"off",onBlur:()=>B({type:Combobox_types.ComboboxActionEnum.search_reset,payload:null}),onChange:e=>{B({type:Combobox_types.ComboboxActionEnum.search_start,payload:{search:e.target.value}}),O&&O(e.target.value),le||ce(!0)},type:"text"})]}))})),Ce="solid"===k?"slate":"gray",ye=()=>{Z.current&&U(i.list({size:q,open:le,mode:y,radius:w,shadow:N}))};return React.useEffect((()=>{var e,o;if(!(null===(e=Y.current)||void 0===e?void 0:e.dataset))return;const t=Object.assign({},null===(o=Y.current)||void 0===o?void 0:o.dataset),s=t.hasOwnProperty("hasLeftElement")&&"true"===t.hasLeftElement,a=t.hasOwnProperty("hasRightElement")&&"true"===t.hasRightElement;T(i.base({className:c,color:m,disabled:K,hasLeftElement:s,hasLeftIcon:L,hasRightElement:a,hasRightIcon:M,radius:w,shadow:N,size:q,tone:k,validation:A,withRing:S}))}),[c,m,K,L,M,w,N,q,i,k,A,S]),jsxRuntime.jsx(jsxRuntime.Fragment,{children:jsxRuntime.jsxs("div",Object.assign({id:G,ref:ue,className:de,onClick:()=>{var e;le||K||ce(!0),null===(e=null==ee?void 0:ee.current)||void 0===e||e.focus()}},P,{children:[h&&jsxRuntime.jsx("span",Object.assign({className:xe},{children:React.cloneElement(h,{className:pe})})),je,g&&jsxRuntime.jsx("span",Object.assign({className:ge},{children:jsxRuntime.jsx(Spinner,{size:q,color:Ce})})),!g&&u&&(null===(a=V.selectedOptions)||void 0===a?void 0:a.length)>0&&jsxRuntime.jsx("button",Object.assign({"aria-label":"Clear",type:"button",disabled:K,onClick:e=>{B({type:Combobox_types.ComboboxActionEnum.reset,payload:null}),B({type:Combobox_types.ComboboxActionEnum.search_reset,payload:null}),e.stopPropagation()},className:ge},{children:jsxRuntime.jsx(XMark.XMarkIcon,{className:he})})),!g&&(!u||0===(null===(n=V.selectedOptions)||void 0===n?void 0:n.length))&&jsxRuntime.jsx("div",Object.assign({className:ge},{children:jsxRuntime.jsx(CaretUpDown.CaretUpDown,{className:he})})),jsxRuntime.jsx(Combobox_context.ComboboxContextProvider,Object.assign({value:oe},{children:jsxRuntime.jsx(react.FloatingPortal,{children:jsxRuntime.jsxs("div",Object.assign({id:F,role:"listbox",ref:be,className:H,style:{display:le?"block":"none",opacity:le&&!K?1:0,maxHeight:`${j}px`,minWidth:`${C}px`,maxWidth:`${J}px`,position:ie,top:se&&se>0&&se!==1/0?se:0,left:te||0}},re,{children:[0===(null==$?void 0:$.length)&&V.searching&&jsxRuntime.jsx("div",Object.assign({className:me},{children:"No results"})),l]}))})}))]}))})}));_Combobox.displayName="Combobox";const Combobox=Object.assign(_Combobox,{Group:ComboboxGroup.ComboboxGroup,Option:ComboboxOption.ComboboxOption});module.exports=Combobox;
